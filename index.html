<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hikers Villa Book</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --blue:#2563eb;
  --bg:#f5f7fb;
  --card:#ffffff;
  --line:#e5e7eb;
  --text:#0f172a;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
}
.hidden{display:none}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:16px;
}
button{
  padding:10px 14px;
  border-radius:10px;
  border:1px solid var(--line);
  background:white;
  font-weight:700;
  cursor:pointer;
}
button.primary{
  background:var(--blue);
  color:white;
  border:none;
}
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--line);
}
label{font-size:13px;font-weight:700}
.row{display:flex;gap:10px;flex-wrap:wrap}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginView" class="card" style="max-width:420px;margin:80px auto">
<h2>Hikers Villa Book</h2>

<form id="loginForm">
<label>Username</label>
<input id="loginUser" required>

<label>Password</label>
<input id="loginPass" type="password" required>

<br><br>
<button class="primary" type="submit">Login</button>
<div id="loginErr" style="color:red;font-weight:700"></div>
</form>
</div>

<!-- APP -->
<div id="appView" class="hidden">

<div class="row" style="padding:10px;background:white;border-bottom:1px solid var(--line)">
<b>Hikers Villa Book</b>
<span id="whoami"></span>
<button onclick="logout()">Logout</button>
</div>

<div class="row" style="padding:10px">

<div style="width:260px">
<button onclick="showTab('availability')">Availability</button>
<button onclick="showTab('create')">Create Booking</button>
<button onclick="showTab('my')">My Bookings</button>
<button id="adminBtn" onclick="showTab('admin')">Admin</button>
</div>

<div style="flex:1">

<!-- AVAILABILITY -->
<div id="tab-availability" class="card">
<h3>Availability</h3>
<p><span style="background:#2563eb;color:white;padding:4px 8px;border-radius:6px">Booked</span></p>
<div id="calendar"></div>
</div>

<!-- CREATE -->
<div id="tab-create" class="card hidden">
<h3>Create Booking</h3>

<div class="grid2">
<label>Room
<select id="room"></select>
</label>

<label>Pax
<select id="pax"></select>
</label>

<label>Check-in
<input type="date" id="checkin">
</label>

<label>Check-out
<input type="date" id="checkout">
</label>

<label>Meal Plan
<select id="meal">
<option value="none">No meal plan</option>
<option value="half">Half Board</option>
<option value="full">Full Board</option>
</select>
</label>

<label>Airport Pickup
<select id="airport">
<option>No</option>
<option>Yes</option>
</select>
</label>

<label>Domestic Ticket
<select id="ticket">
<option>No</option>
<option>Yes</option>
</select>
</label>
</div>

<h4>Guests</h4>
<div id="guests"></div>

<h3 id="totalPrice">$0</h3>

<button class="primary" onclick="submitBooking()">Submit</button>
</div>

<!-- MY BOOKINGS -->
<div id="tab-my" class="card hidden">
<h3>My Bookings</h3>
<div id="myBookings"></div>
</div>

<!-- ADMIN -->
<div id="tab-admin" class="card hidden">
<h3>Admin Panel</h3>
<div id="adminBookings"></div>
</div>

</div>
</div>
</div>

<script>
/* USERS */
const USERS=[
{u:"admin",p:"admin123!-",r:"admin"},
{u:"agent1",p:"agent1231",r:"agent"},
{u:"agent2",p:"agent1232",r:"agent"},
{u:"agent3",p:"agent1233",r:"agent"},
];

/* ROOMS */
const ROOMS={
R101:{name:"Room 101",base:60,pax:[2]},
R102:{name:"Room 102",base:55,pax:[2]},
R103:{name:"Family Suite",base:55,pax:[2,3,4]},
R104:{name:"Room 104",base:55,pax:[2]},
R105:{name:"Room 105",base:55,pax:[2]},
};

/* STATE */
let session=null;
let bookings=JSON.parse(localStorage.getItem("hvb")||"[]");

/* LOGIN */
loginForm.onsubmit=e=>{
e.preventDefault();
const u=loginUser.value;
const p=loginPass.value;
const user=USERS.find(x=>x.u===u && x.p===p);
if(!user){loginErr.textContent="Invalid login";return;}
session=user;
loginView.classList.add("hidden");
appView.classList.remove("hidden");
whoami.textContent="User: "+user.u;
adminBtn.style.display=user.r==="admin"?"block":"none";
initForm();
render();
}

/* LOGOUT */
function logout(){
session=null;
location.reload();
}

/* TABS */
function showTab(t){
["availability","create","my","admin"].forEach(x=>{
document.getElementById("tab-"+x).classList.add("hidden");
});
document.getElementById("tab-"+t).classList.remove("hidden");
}

/* INIT FORM */
function initForm(){
room.innerHTML="";
Object.keys(ROOMS).forEach(k=>{
room.innerHTML+=`<option value="${k}">${ROOMS[k].name}</option>`;
});
room.onchange=updatePax;
updatePax();
}

/* PAX */
function updatePax(){
pax.innerHTML="";
ROOMS[room.value].pax.forEach(p=>pax.innerHTML+=`<option>${p}</option>`);
updateGuests();
}

/* GUESTS */
pax.onchange=updateGuests;
function updateGuests(){
guests.innerHTML="";
for(let i=1;i<=pax.value;i++){
guests.innerHTML+=`
<label>Guest ${i} Name<input></label>
<label>Guest ${i} Passport<input></label>`;
}
calcPrice();
}

/* PRICE */
["room","pax","meal","airport","ticket","checkin","checkout"].forEach(id=>{
document.getElementById(id).onchange=calcPrice;
});

function calcPrice(){
const nights=(new Date(checkout.value)-new Date(checkin.value))/(1000*60*60*24)||0;
let base=ROOMS[room.value].base;
if(room.value==="R103" && pax.value==3) base=85;
if(room.value==="R103" && pax.value==4) base=100;

let total=base*nights;
if(meal.value==="half") total+=20*nights;
if(meal.value==="full") total+=40*nights;
if(airport.value==="Yes") total+=20;
if(ticket.value==="Yes") total+=310*pax.value;

totalPrice.textContent="$"+total;
}

/* SUBMIT */
function submitBooking(){
bookings.push({
id:Date.now(),
user:session.u,
room:room.value,
pax:pax.value,
from:checkin.value,
to:checkout.value,
total:totalPrice.textContent,
status:"pending"
});
localStorage.setItem("hvb",JSON.stringify(bookings));
alert("Booking submitted");
render();
showTab("my");
}

/* RENDER */
function render(){
calendar.innerHTML="";
Object.keys(ROOMS).forEach(r=>{
calendar.innerHTML+=`<div>${ROOMS[r].name}</div>`;
});
myBookings.innerHTML=bookings.filter(b=>b.user===session.u)
.map(b=>`#${b.id} ${b.room} ${b.total}`).join("<br>");
adminBookings.innerHTML=bookings.map(b=>`#${b.id} ${b.user} ${b.total}`).join("<br>");
}
</script>

</body>
</html>
